"use strict";

const fs = require("node:fs");
const { Port } = require("./Settings/envvars.js");

// https://dev.to/luizcalaca/autogenerated-documentation-api-with-openapi-and-swagger-for-nodejs-and-express-31g9
// https://swagger-autogen.github.io/docs/openapi-3/

const swaggerAutogen = require("swagger-autogen")({ openapi: "3.0.0" });

const outputFile = "./swagger.json";

// Add all routers here
const endpointsFiles = ["./routers/personRouter.js"];

swaggerAutogen(outputFile, endpointsFiles).then((data) => {
  console.log("Updating " + outputFile);

  let openapi3 = require(outputFile);
  openapi3.servers[0].url = "http://localhost:" + Port;
  var json = JSON.stringify(openapi3, null, 2);
  fs.writeFile(outputFile, json, (err) => {
    if (err) console.log(JSON.stringify(err));
  });
});
